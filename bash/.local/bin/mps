#!/bin/bash
set -e

mode="$1"
config_dir="$HOME"/.config/mps-youtube
config_path="$config_dir"/config

if [ -z "$mode" ]; then
	mode="video"
fi

if [ "$mode" != "video" ] && [ "$mode" != "audio" ]; then
	printf "Wrong mode: %s. Aborting.\n" "$mode"
	exit 1
fi

if [ -L "$config_path" ]; then
	rm -f "$config_path"
elif [ -f "$config_path" ]; then
	printf "%s appears to be a file, not symlink. Backing up.\n" "$config_path"
	backup=1
	mv "$config_path" "$config_path".bak
fi

ln -s "$config_path.$mode" "$config_path"	
printf "Set config for mode: %s.\n" "$mode"

echo "Starting mpsyt..."
mpsyt "${@:2}"

echo "Cleaning up..."
if [ -n "$backup" ]; then
	mv "$config_path".bak "$config_path"
else
	rm -f "$config_path"
fi

exit 0

